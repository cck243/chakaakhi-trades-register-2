<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sales & Purchase with Ledger</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #aaa; padding: 6px; text-align: left; }
    th { background: #f0f0f0; }
    h2 { margin-bottom: 8px; }
    input, select, button { margin: 4px; padding: 6px; }
  </style>
</head>
<body>

<h1>Sales, Purchase & Ledger Management</h1>

<!-- Customers -->
<section id="customers">
  <h2>Customers</h2>
  <form id="customerForm">
    <input type="text" id="customerName" placeholder="Customer Name" required>
    <input type="number" id="openingBalance" placeholder="Opening Balance" value="0">
    <button type="submit">Add Customer</button>
  </form>
  <table id="customersTable">
    <thead><tr><th>Name</th><th>Opening Balance</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<!-- Products -->
<section id="products">
  <h2>Products</h2>
  <form id="productForm">
    <input type="text" id="productName" placeholder="Product Name" required>
    <input type="number" id="productQty" placeholder="Qty" required>
    <button type="submit">Add Product</button>
  </form>
  <table id="productsTable">
    <thead><tr><th>Product</th><th>Stock Qty</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<!-- Sales -->
<section id="sales">
  <h2>Sales Entry</h2>
  <form id="salesForm">
    <select id="salesCustomer" required></select>
    <select id="salesProduct" required></select>
    <input type="number" id="salesQty" placeholder="Qty" required>
    <input type="number" id="salesPrice" placeholder="Price" required>
    <button type="submit">Add Sale</button>
  </form>
  <table id="salesTable">
    <thead><tr><th>Date</th><th>Customer</th><th>Product</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<!-- Purchases -->
<section id="purchases">
  <h2>Purchase Entry</h2>
  <form id="purchaseForm">
    <select id="purchaseProduct" required></select>
    <input type="number" id="purchaseQty" placeholder="Qty" required>
    <input type="number" id="purchasePrice" placeholder="Price" required>
    <button type="submit">Add Purchase</button>
  </form>
  <table id="purchasesTable">
    <thead><tr><th>Date</th><th>Product</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<!-- Payments & Receipts -->
<section id="payments">
  <h2>Payments & Receipts</h2>
  <form id="paymentForm">
    <label>Customer:</label>
    <select id="paymentCustomer" required></select>

    <label>Type:</label>
    <select id="paymentType" required>
      <option value="Payment">Payment</option>
      <option value="Receipt">Receipt</option>
    </select>

    <label>Amount:</label>
    <input type="number" id="paymentAmount" placeholder="Amount" required>

    <button type="submit">Add Entry</button>
  </form>

  <h3>Payment & Receipt Records</h3>
  <table border="1" id="paymentsTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Customer</th>
        <th>Type</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- Ledger -->
<section id="ledger">
  <h2>Customer Ledger</h2>
  <input type="text" id="ledgerSearch" placeholder="Enter customer name">
  <button onclick="showLedger()">Show Ledger</button>
  <h3 id="ledgerTitle"></h3>
  <table id="ledgerTable">
    <thead><tr><th>Date</th><th>Type</th><th>Details</th><th>Debit</th><th>Credit</th><th>Balance</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<script>
let customers = JSON.parse(localStorage.getItem("customers")) || [];
let products = JSON.parse(localStorage.getItem("products")) || [];
let sales = JSON.parse(localStorage.getItem("sales")) || [];
let purchases = JSON.parse(localStorage.getItem("purchases")) || [];
let payments = JSON.parse(localStorage.getItem("payments")) || [];

// ========== CUSTOMERS ==========
function renderCustomers() {
  const tbody = document.querySelector("#customersTable tbody");
  tbody.innerHTML = "";
  customers.forEach(c => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${c.name}</td><td>${c.openingBalance.toFixed(2)}</td>`;
    tbody.appendChild(tr);
  });
  updateDropdowns();
}
document.getElementById("customerForm").addEventListener("submit", e => {
  e.preventDefault();
  const name = document.getElementById("customerName").value;
  const openingBalance = parseFloat(document.getElementById("openingBalance").value) || 0;
  customers.push({ name, openingBalance });
  localStorage.setItem("customers", JSON.stringify(customers));
  renderCustomers();
  e.target.reset();
});

// ========== PRODUCTS ==========
function renderProducts() {
  const tbody = document.querySelector("#productsTable tbody");
  tbody.innerHTML = "";
  products.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.name}</td><td>${p.qty}</td>`;
    tbody.appendChild(tr);
  });
  updateDropdowns();
}
document.getElementById("productForm").addEventListener("submit", e => {
  e.preventDefault();
  const name = document.getElementById("productName").value;
  const qty = parseFloat(document.getElementById("productQty").value);
  products.push({ name, qty });
  localStorage.setItem("products", JSON.stringify(products));
  renderProducts();
  e.target.reset();
});

// ========== SALES ==========
function renderSales() {
  const tbody = document.querySelector("#salesTable tbody");
  tbody.innerHTML = "";
  sales.forEach(s => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${s.date}</td><td>${s.customer}</td><td>${s.product}</td><td>${s.qty}</td><td>${s.price}</td><td>${s.total}</td>`;
    tbody.appendChild(tr);
  });
}
document.getElementById("salesForm").addEventListener("submit", e => {
  e.preventDefault();
  const customer = document.getElementById("salesCustomer").value;
  const product = document.getElementById("salesProduct").value;
  const qty = parseFloat(document.getElementById("salesQty").value);
  const price = parseFloat(document.getElementById("salesPrice").value);
  const total = qty * price;
  const sale = { date: new Date().toLocaleDateString(), customer, product, qty, price, total };
  sales.push(sale);
  // reduce stock
  const prod = products.find(p => p.name === product);
  if (prod) prod.qty -= qty;
  localStorage.setItem("sales", JSON.stringify(sales));
  localStorage.setItem("products", JSON.stringify(products));
  renderSales(); renderProducts();
  e.target.reset();
});

// ========== PURCHASES ==========
function renderPurchases() {
  const tbody = document.querySelector("#purchasesTable tbody");
  tbody.innerHTML = "";
  purchases.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.date}</td><td>${p.product}</td><td>${p.qty}</td><td>${p.price}</td><td>${p.total}</td>`;
    tbody.appendChild(tr);
  });
}
document.getElementById("purchaseForm").addEventListener("submit", e => {
  e.preventDefault();
  const product = document.getElementById("purchaseProduct").value;
  const qty = parseFloat(document.getElementById("purchaseQty").value);
  const price = parseFloat(document.getElementById("purchasePrice").value);
  const total = qty * price;
  const purchase = { date: new Date().toLocaleDateString(), product, qty, price, total };
  purchases.push(purchase);
  // increase stock
  const prod = products.find(p => p.name === product);
  if (prod) prod.qty += qty;
  localStorage.setItem("purchases", JSON.stringify(purchases));
  localStorage.setItem("products", JSON.stringify(products));
  renderPurchases(); renderProducts();
  e.target.reset();
});

// ========== PAYMENTS ==========
function renderPayments() {
  const tbody = document.querySelector("#paymentsTable tbody");
  tbody.innerHTML = "";
  payments.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.date}</td><td>${p.customer}</td><td>${p.type}</td><td>${p.amount.toFixed(2)}</td>`;
    tbody.appendChild(tr);
  });
}
document.getElementById("paymentForm").addEventListener("submit", e => {
  e.preventDefault();
  const customer = document.getElementById("paymentCustomer").value;
  const type = document.getElementById("paymentType").value;
  const amount = parseFloat(document.getElementById("paymentAmount").value);
  const entry = { date: new Date().toLocaleDateString(), customer, type, amount };
  payments.push(entry);
  localStorage.setItem("payments", JSON.stringify(payments));
  renderPayments();
  e.target.reset();
});

// ========== LEDGER ==========
function showLedger() {
  const name = document.getElementById("ledgerSearch").value.trim();
  if (!name) return alert("Enter a customer name");
  document.getElementById("ledgerTitle").textContent = `Ledger for ${name}`;
  const tbody = document.querySelector("#ledgerTable tbody");
  tbody.innerHTML = "";

  let customer = customers.find(c => c.name === name);
  let balance = customer ? customer.openingBalance : 0;
  if (balance) {
    const row = document.createElement("tr");
    row.innerHTML = `<td>-</td><td>Opening</td><td>Opening Balance</td><td>${balance.toFixed(2)}</td><td></td><td>${balance.toFixed(2)}</td>`;
    tbody.appendChild(row);
  }

  let transactions = [];

  sales.forEach(s => { if (s.customer === name) transactions.push({ date: s.date, type: "Sale", details: s.product, debit: s.total, credit: 0 }); });
  payments.forEach(p => { if (p.customer === name) {
    if (p.type === "Payment") transactions.push({ date: p.date, type: "Payment", details: "-", debit: 0, credit: p.amount });
    else transactions.push({ date: p.date, type: "Receipt", details: "-", debit: p.amount, credit: 0 });
  }});

  transactions.sort((a,b)=> new Date(a.date)-new Date(b.date));
  transactions.forEach(t => {
    balance += t.debit - t.credit;
    const row = document.createElement("tr");
    row.innerHTML = `<td>${t.date}</td><td>${t.type}</td><td>${t.details}</td><td>${t.debit?t.debit.toFixed(2):""}</td><td>${t.credit?t.credit.toFixed(2):""}</td><td>${balance.toFixed(2)}</td>`;
    tbody.appendChild(row);
  });
}

// ========== DROPDOWNS ==========
function updateDropdowns() {
  const salesCust = document.getElementById("salesCustomer");
  const payCust = document.getElementById("paymentCustomer");
  [salesCust, payCust].forEach(sel => { sel.innerHTML = ""; customers.forEach(c=>{ let o=document.createElement("option"); o.value=c.name; o.textContent=c.name; sel.appendChild(o); }); });
  const salesProd = document.getElementById("salesProduct");
  const purProd = document.getElementById("purchaseProduct");
  [salesProd, purProd].forEach(sel => { sel.innerHTML = ""; products.forEach(p=>{ let o=document.createElement("option"); o.value=p.name; o.textContent=p.name; sel.appendChild(o); }); });
}

// Init
renderCustomers(); renderProducts(); renderSales(); renderPurchases(); renderPayments();
</script>
</body>
</html>
